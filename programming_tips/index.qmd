---
title: "Some Programming Tips"
subtitle: RA Bootcamp Day 2
author:
  - name: æŸ³æœ¬å’Œæ˜¥
    email: kazuharu.yanagimoto@cemfi.edu.es
    orcid: 0009-0007-1967-8304
    affiliations:
    - name: CEMFI
date: 2023-08-30
date-format: long
image: img/thumbnail.svg
execute:
    echo: true
    warning: false
    message: false
    cache: false
format:
  revealjs:
    width: 1600
    height: 900
    theme: [default, ../static/css/quartomonothemer.scss, ../static/css/custom.scss]
    slide-number: true
    fig-cap-location: top
    fig-format: svg
    pdf-separate-fragments: false
---


# Introduction {visibility="hidden"}

```{r}
#| eval: true
#| echo: false
library(tidyverse)
library(gt)
library(gtExtras)
library(quartomonothemer)
library(showtext)

font_title <- "Zen Maru Gothic"
font_text <- "Noto Sans JP"
color_base <- "#009F8C"
color_base_light <- "#95DFD6"
color_accent <- "#B75C9D"
color_accent_light <- "#DBA6CC"
gray <- "#bebebe"
darkgray <- "#6d6d6d"

font_add_google(font_title)
font_add_google(font_text)
showtext_auto()

style_mono_quarto(
  font_title = font_title,
  font_text = font_text,
  google_fonts = c(font_title, font_text),
  color_base = color_base,
  color_accent = color_accent,
  color_link = color_accent,
  color_code = color_base,
  size_base = 30,
  path_scss = here::here("static/css/quartomonothemer.scss")
)
```


## è‰¯ã„ã‚³ãƒ¼ãƒ‰ã¨ã¯ä½•ã‹

::: {.callout-note}

## èª­ã¿ã‚„ã™ã•ã®åŸºæœ¬çš„å®šç† [@boswell2011]

ã‚³ãƒ¼ãƒ‰ã¯ä»–ã®äººãŒæœ€çŸ­æ™‚é–“ã§ç†è§£ã§ãã‚‹ã‚ˆã†ã«æ›¸ã‹ãªã‘ã‚Œã°ã„ã‘ãªã„

:::

**èª­ã¿ã‚„ã™ã•ã‚’ä¸Šã’ã‚‹Tips**

- ã‚«ãƒ©ãƒ•ãƒ«ãªãƒãƒ¼ãƒŸãƒ³ã‚°
- DRYåŸå‰‡
- ãƒ‘ãƒ¯ãƒ•ãƒ«ãªé–¢æ•°
- æˆ¦ç•¥çš„ãªã‚³ãƒ¡ãƒ³ãƒˆ
- è„³ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€å°åŒ–

## ã‚«ãƒ©ãƒ•ãƒ«ãªãƒãƒ¼ãƒŸãƒ³ã‚°

å¤‰æ•°ã®ä¸­èº« (å‹) ãŒã‚³ãƒ¼ãƒ‰ãƒ–ãƒƒã‚¯ã‚’èª­ã¾ãªãã¦ã‚‚é¡æ¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨èª­ã¿ã‚„ã™ã„

- **ãƒ–ãƒ¼ãƒ«ä»£æ•°**: `is_female`, `has_kids`, ãªã©
- **æ•°å€¤**: `hours_worked`, `num_child` ãªã©ã¯æ•°å€¤ã§ã‚ã‚‹ã“ã¨ãŒæƒ³å®šã—ã‚„ã™ã„
- **ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°**: `industry_c8`, `emp_c3` ãªã©ã‚«ãƒ†ã‚´ãƒªæ•°ã‚’æ˜ç¤ºã™ã‚‹

é€†ã«, `child` ãªã©ã¯å­ä¾›æ•°ãªã®ã‹, å­ä¾›ã®æœ‰ç„¡ãªã®ã‹, ä½•ã‹åˆ¥ã®æ„å‘³ãªã®ã‹åˆ†ã‹ã‚‰ãªã„

## Do not Repeat Yourself (DRY)

**äºŒå›æ›¸ããªã‚‰é–¢æ•°ã«ã™ã‚‹**

- ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ãŸã“ã¨ã¯, ä»–ã®äººã¯è¦‹ã¦ã„ãªã„
- èª°ã‹ãŒå¤‰æ›´ã«æ°—ã¥ã„ãŸã¨ãã«, ã‚³ãƒ”ãƒ¼å…ˆã¾ã§å¤‰æ›´ã—ã¦ãã‚Œã‚‹ã¨ã¯é™ã‚‰ãªã„
- é–¢æ•°åŒ–ã—ã¦ã„ãªã„éƒ¨åˆ†ã¯, åŒã˜å‡¦ç†ãªã®ã‹ãƒã‚§ãƒƒã‚¯ã—ãªã„ã¨ã„ã‘ãªã„


ã¡ãªã¿ã«, DRYåŸå‰‡ã‚’æº€ãŸã—ã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰ã‚’ Write Everything Twice (WET) ã¨å‘¼ã¶

## ãƒ‘ãƒ¯ãƒ•ãƒ«ãªé–¢æ•°

"äº”æŒ‡, æ‰‹ã®ã²ã‚‰, æ‰‹ã®ç”²ã¨æ‰‹é¦–ã‚’è¦†ã†å¸ƒã‚’èº«ã«ã¤ã‘ã‚‹" $\Rightarrow$ "æ‰‹è¢‹ã‚’ã¯ã‚ã‚‹"

:::: {.columns}

::: {.column width="50%"}

ğŸ˜…

```{.r}
df |>
  rename(gender = sex) |>
  select(wage, hour, year, gender) |>
  filter(year >= 1985, year <= 2000) |>
  group_by(year, gender) |>
  summarize(hour = mean(hour),
            wage = mean(wage),
            .groups = "drop")
```

:::

::: {.column width="50%"}

ğŸ˜†

```{.r}
df |>
  select(wage, hour, year, gender = sex) |>
  filter(between(year, 1985, 2000)) |>
  summarize(across(c(hour, wage), mean),
            .by = c("year", "gender"))
```

:::

::::

ãã®ä»–, `recode_factor()`, `case_when()`, `janitor::clean_names()` ãªã©


## æˆ¦ç•¥çš„ãªã‚³ãƒ¡ãƒ³ãƒˆ

**~~ã‚³ãƒ¡ãƒ³ãƒˆã§èª¬æ˜ã™ã‚‹~~ $\Rightarrow$ ã‚³ãƒ¼ãƒ‰ã§èª¬æ˜ã§ããªã„æ™‚ã®æœ€çµ‚æ‰‹æ®µ**

- ã‚³ãƒ¡ãƒ³ãƒˆãŒãªãã¦ã‚‚ååˆ†ä¼ã‚ã‚‹ãªã‚‰, ã‚³ãƒ¡ãƒ³ãƒˆã¯é‚ªé­”ãªã ã‘
- è¦‹å‡ºã—ã‚„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã®æ©Ÿèƒ½çš„ãªã‚³ãƒ¡ãƒ³ãƒˆä»¥å¤–ã¯, æœ€å°é™ã«

**ãƒã‚¤ãƒªãƒ³ã‚¬ãƒ«ã‚³ãƒ¡ãƒ³ãƒˆ**

- æ—¥æœ¬èªã®ã‚³ãƒ¡ãƒ³ãƒˆ
    - ä½œæ¥­ä¸­ã®ã‚³ãƒ¡ãƒ³ãƒˆ. æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã«æ®‹ã•ãªã„
    - è€ƒãˆæ–¹ã®æ•´ç†ã‚„ç¿Œæ—¥ã®ä½œæ¥­å†…å®¹ã‚’ãƒ¡ãƒ¢ã™ã‚‹
- è‹±èªã®ã‚³ãƒ¡ãƒ³ãƒˆ
    - æ­£å¼ãªã‚³ãƒ¡ãƒ³ãƒˆ. æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã«æ®‹ã™
    - æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã¯è‹±èªã—ã‹æ®‹ã‚‰ãªã„ã®ã§, èª°ã«ã§ã‚‚ã‚·ã‚§ã‚¢ã§ãã‚‹

## è„³ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€å°åŒ–: ä¸å¿…è¦ãªå†ä»£å…¥

:::: {.columns}

::: {.column width="50%"}

ğŸ˜…

```{.r}
data  <- data |>
  filter(year <= 1985)

#---------------------
# ä¸­ç•¥
#---------------------

data <- data |>
  filter(year >= 2000)

```

:::

::: {.column width="50%"}

ğŸ˜†

```{.r}
data_m1985  <- data |>
  filter(year <= 1985)

#---------------------
# ä¸­ç•¥
#---------------------

data_1985_2000 <- data |>
  filter(between(year, 1985, 2000))

```

:::

::::

<br>

- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®å†ä»£å…¥ã¯, è¡Œã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®çŠ¶æ…‹ã¨ã„ã†è„³ã®å®¹é‡ã‚’æ¶ˆè²»ã™ã‚‹
- ãƒ‡ãƒãƒƒã‚°ä¸­ã‚‚, ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œé †ã‚’æ„è­˜ã—ãªã„ã¨ã„ã‘ãªã„

## è„³ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€å°åŒ–: ä¸å¿…è¦ãªä¸­é–“å¤‰æ•°

:::: {.columns}

::: {.column width="50%"}

ğŸ˜…

```{.r}
df |>
  mutate(x2 = x^2,
         y = x2 + 1)
```

:::

::: {.column width="50%"}

ğŸ˜†

```{.r}
df |>
  mutate(y = x^2 + 1)

```

:::

::::

<br>

- `x2`ã¨ã„ã†åˆ—ã¯`y`ã¨ã„ã†åˆ—ã‚’ä½œã‚‹ãŸã‚ã®ä¸€æ™‚çš„ãªåˆ—ã§ã‚ã‚‹
- èª­ã¿æ‰‹ã«ã¨ã£ã¦ã¯, ä»Šå¾Œ`x2`ã¨ã„ã†åˆ—ãŒä½¿ã‚ã‚Œã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã®ã§, `x2`ã®å®šç¾©ã‚’è¦šãˆãªãŒã‚‰èª­ã¿é€²ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
- ä¸€æ™‚çš„ãªåˆ—ã§ä»Šå¾Œä½¿ã‚ãªã„åˆ—å (ã¾ãŸã¯å¤‰æ•°) ã¯`tmp`ãªã©ã®å‘½åã«ã‚ˆã£ã¦æ˜ç¤ºçš„ã«ã™ã‚‹

## References {visibility="uncounted"}

::: {#refs}
:::